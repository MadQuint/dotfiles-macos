# ===========================
# BASIC SETTINGS
# ===========================

# True color support
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# Set prefix to Ctrl-a (more ergonomic than Ctrl-b)
set -g prefix C-a
unbind C-b
bind-key C-a send-prefix

# Start windows and panes at 1, not 0
set -g base-index 1
set -g pane-base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on

# Remove delay for exiting insert mode with ESC in Neovim
set -sg escape-time 10

# Increase scrollback buffer size
set -g history-limit 50000

# Display tmux messages for 4 seconds
set -g display-time 4000

# Refresh status line every 5 seconds
set -g status-interval 5

# Focus events enabled for terminals that support them
set -g focus-events on

# Enable mouse support
set -g mouse on

# ===========================
# KEY BINDINGS
# ===========================

# Reload config
unbind r
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# Split panes using | and -
unbind %
bind | split-window -h -c "#{pane_current_path}"
unbind '"'
bind - split-window -v -c "#{pane_current_path}"

# Create new window in current path
bind c new-window -c "#{pane_current_path}"

# Resize panes with vim-like keys
bind -r j resize-pane -D 5
bind -r k resize-pane -U 5
bind -r l resize-pane -R 5
bind -r h resize-pane -L 5

# Maximize/minimize pane
bind -r m resize-pane -Z

# Switch windows easily
bind -n M-H previous-window
bind -n M-L next-window

# Move windows
bind -n M-j swap-window -t -1\; select-window -t -1
bind -n M-k swap-window -t +1\; select-window -t +1

# ===========================
# VIM MODE & COPY
# ===========================

set-window-option -g mode-keys vi

# Vi-like copy mode
bind-key -T copy-mode-vi 'v' send -X begin-selection
bind-key -T copy-mode-vi 'C-v' send -X rectangle-toggle
bind-key -T copy-mode-vi 'y' send -X copy-selection-and-cancel

# Don't exit copy mode when dragging with mouse
unbind -T copy-mode-vi MouseDragEnd1Pane

# ===========================
# PLUGINS
# ===========================

set -g @plugin 'tmux-plugins/tpm'

# Essential plugins
set -g @plugin 'christoomey/vim-tmux-navigator' # Seamless vim-tmux navigation
set -g @plugin 'tmux-plugins/tmux-sensible'     # Sensible defaults
set -g @plugin 'tmux-plugins/tmux-yank'         # Enhanced copy to system clipboard

# Session management
set -g @plugin 'tmux-plugins/tmux-resurrect'    # Save/restore sessions
set -g @plugin 'tmux-plugins/tmux-continuum'    # Auto-save sessions

# Developer tools
set -g @plugin 'tmux-plugins/tmux-open'         # Open highlighted files/URLs
set -g @plugin 'tmux-plugins/tmux-sessionist'   # Session management shortcuts
set -g @plugin 'sainnhe/tmux-fzf'               # Fuzzy finder integration

# Theme (Gruvbox to match Starship)
set -g @plugin 'egel/tmux-gruvbox'
set -g @tmux-gruvbox 'dark'

# ===========================
# PLUGIN SETTINGS
# ===========================

# Resurrect: capture pane contents and vim/nvim sessions
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-strategy-nvim 'session'

# Continuum: auto-restore and auto-save
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'

# tmux-open: open files with 'o', URLs with Ctrl-o
set -g @open-S 'https://www.google.com/search?q='

# ===========================
# STATUS BAR CUSTOMIZATION
# ===========================

# Status bar position
set -g status-position top

# ===========================
# DEVELOPER SHORTCUTS
# ===========================

# Quick session switching (prefix + g)
bind g run-shell "tmux display-popup -E 'tmux-fzf switch-session'"

# Quick window switching (prefix + w with fzf)
bind w run-shell "tmux display-popup -E 'tmux-fzf switch-window'"

# Split pane and run commands
bind C-g split-window -h -c "#{pane_current_path}" "lazygit"
bind C-h split-window -h -c "#{pane_current_path}" "htop"

# ===========================
# INSTALL TPM if not installed
# ===========================

# Initialize TMUX plugin manager (keep this line at the very bottom)
if "test ! -d ~/.tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && ~/.tmux/plugins/tpm/bin/install_plugins'"

run '~/.tmux/plugins/tpm/tpm'
